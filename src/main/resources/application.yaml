# ========================================
# æ™ºèƒ½æ–‡æœ¬æå–æœåŠ¡ - ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£é…ç½®
# ========================================

server:
  port: 2701
  
spring:
  application:
    name: extract-service
    
  # æ•°æ®åº“é…ç½® - æŒ‰ç…§plantextæ–‡æ¡£
  datasource:
    url: jdbc:mysql://localhost:3306/extract-graph?useUnicode=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    
  # JPAé…ç½®
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true
        
  # Redisé…ç½®
  data:
    redis:
      host: localhost
      port: 6379
      timeout: 2000ms
    
# MCP SSE æ ¸å¿ƒé…ç½® - ç¬¬3ç« æ¶æ„è¦æ±‚
ai:
  mcp:
    server:
      name: intelligent-extraction-service-prod
      type: ASYNC
      version: 1.0.0
      enabled: true
      sse-endpoint: /sse
      sse-message-endpoint: /mcp/message
      request-timeout: 60000
      max-connections: 100
      capabilities:
        tool: true
        resource: true
        prompt: true
        completion: true
      
# æ™ºèƒ½é…ç½®ï¼šè‡ªé€‚åº”å‚æ•° - ç¬¬4ç« å¤„ç†å¼•æ“é…ç½® (ä¼˜åŒ–ç‰ˆ)
extraction:
  ai:
    providers:
      deepseek:
        api-key: sk-cea6dbdbba694338b5f4abe9dfb0975b
        url: https://api.deepseek.com/v1/chat/completions
        # ğŸš€ ä¼˜åŒ–è¶…æ—¶é…ç½®ï¼šåŸºç¡€è¶…æ—¶ + åŠ¨æ€è°ƒæ•´
        base-timeout: 30s
        max-timeout: 180s
        timeout-per-1000-chars: 10s
        # ğŸ”„ ä¼˜åŒ–é‡è¯•é…ç½®
        retry-count: 4
        retry-base-delay: 2s
        retry-max-delay: 30s
        # ğŸ›¡ï¸ å¹¶å‘æ§åˆ¶
        max-concurrent-calls: 5
        # ğŸ“Š ç›‘æ§é…ç½®
        enable-metrics: true
        fallback-enabled: true
      local:
        enabled: true
        confidence-threshold: 0.7
        
  cache:
    l1:
      type: caffeine
      max-size: 1000
      expire-after-write: 1h
    l2:
      type: file
      max-size: 10000
      expire-after-write: 24h
      
  processing:
    batch-size: 10
    parallel-threads: 4
    timeout: 120s
    
  # ğŸŒ ç½‘ç»œé…ç½®ä¼˜åŒ–
  webclient:
    # è¿æ¥æ± é…ç½®
    connection-pool:
      max-connections: 50
      max-idle-time: 30s
      max-life-time: 60s
      pending-acquire-timeout: 60s
    # è¶…æ—¶é…ç½®
    connect-timeout: 10s
    read-timeout: 180s
    write-timeout: 60s
    # SSLé…ç½®
    ssl:
      handshake-timeout: 10s
    
# æ™ºèƒ½ç›‘æ§é…ç½® - ç¬¬9ç« ç›‘æ§æ¶æ„
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,info
  prometheus:
    metrics:
      export:
        enabled: true
    distribution:
      percentiles:
        http.server.requests: 0.5,0.95,0.99

# æ—¥å¿—é…ç½® - ä¸logback-spring.xmlé…åˆä½¿ç”¨
logging:
  # æ ¹æ®logback-spring.xmlé…ç½®ï¼Œè¿™é‡Œçš„é…ç½®ä¼šè¢«è¦†ç›–ï¼Œä½†ä¿ç•™ä»¥é˜²ä¸‡ä¸€
  level:
    root: INFO
    com.datacenter.extract: INFO
    org.springframework: INFO
    org.springframework.web: INFO
    org.springframework.boot: INFO
    org.hibernate: WARN
    org.hibernate.SQL: DEBUG
    org.hibernate.type: TRACE
    com.zaxxer.hikari: INFO
    io.lettuce: WARN
    io.netty: WARN
    org.apache.http: WARN
    com.github.benmanes.caffeine: INFO
  
  # æ—¥å¿—æ ¼å¼ï¼ˆè¢«logback-spring.xmlè¦†ç›–ï¼‰
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%logger{36}] - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
  
  # æ—¥å¿—æ–‡ä»¶é…ç½®ï¼ˆè¢«logback-spring.xmlè¦†ç›–ï¼‰
  file:
    name: ./log/extract_service.log