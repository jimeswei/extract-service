# æ™ºèƒ½æ–‡æœ¬æå–æœåŠ¡ - ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£ v2.0

## ğŸ“‹ æ–‡æ¡£è¯´æ˜
æœ¬æ–‡æ¡£åŸºäºå®é™…ä»£ç å®ç°ç¼–å†™ï¼Œåæ˜ ç³»ç»ŸçœŸå®æ¶æ„çŠ¶æ€
- **ç‰ˆæœ¬**: v2.0  
- **æ›´æ–°æ—¶é—´**: 2024-12-19
- **ä»£ç åˆ†æåŸºç¡€**: å®Œæ•´codebaseæ‰«æç»“æœ

## 1. ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### 1.1 è®¾è®¡åŸåˆ™
- **å¼‚æ­¥ä¼˜å…ˆ**: æ‰€æœ‰æå–ä»»åŠ¡å¼‚æ­¥å¤„ç†ï¼Œç«‹å³å“åº”ç”¨æˆ·
- **æ™ºèƒ½ç¼“å­˜**: Caffeineæœ¬åœ°ç¼“å­˜ + æ™ºèƒ½é•¿æ–‡æœ¬å¤„ç†
- **åˆ†å±‚è§£è€¦**: Controller â†’ Service â†’ Provider â†’ Caller â†’ Database
- **å¹¶å‘å®‰å…¨**: ä¿¡å·é‡æ§åˆ¶ + çº¿ç¨‹æ± ç®¡ç†
- **æ•°æ®é©±åŠ¨**: 7è¡¨çŸ¥è¯†å›¾è°±å­˜å‚¨ï¼Œè‡ªåŠ¨å…³ç³»æ˜ å°„

### 1.2 æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ™ºèƒ½æ–‡æœ¬æå–æœåŠ¡æ¶æ„ v2.0                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTPå®¢æˆ·ç«¯     â”‚    â”‚              åº”ç”¨å±‚ (Controller)       â”‚
â”‚                â”‚    â”‚                                       â”‚
â”‚  â€¢ cURL         â”‚â—„â”€â”€â–ºâ”‚  AsyncExtractController               â”‚
â”‚  â€¢ Postman      â”‚    â”‚  â”œâ”€â”€ POST /api/v1/async/extract      â”‚
â”‚  â€¢ Python SDK   â”‚    â”‚  â”œâ”€â”€ GET  /api/v1/async/health       â”‚
â”‚  â€¢ JavaScript   â”‚    â”‚  â””â”€â”€ GET  /api/v1/async/info         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚             ä¸šåŠ¡å±‚ (Service)             â”‚
                       â”‚                                         â”‚
                       â”‚  TextExtractionService (å¼‚æ­¥ç¼–æ’)        â”‚
                       â”‚  â”œâ”€â”€ @Async processTextAsync()          â”‚
                       â”‚  â”œâ”€â”€ @Tool extractTextData()            â”‚
                       â”‚  â””â”€â”€ HealthCheck & Monitoring           â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚            AIå¤„ç†å±‚ (Provider)           â”‚
                       â”‚                                         â”‚
                       â”‚  SmartAIProvider (æ™ºèƒ½è·¯ç”±)              â”‚
                       â”‚  â”œâ”€â”€ Caffeine Cache (1å°æ—¶TTL)          â”‚
                       â”‚  â”œâ”€â”€ é•¿æ–‡æœ¬é˜ˆå€¼åˆ¤æ–­ (>2000å­—ç¬¦)           â”‚
                       â”‚  â”œâ”€â”€ LongTextProcessor (åˆ†ç‰‡å¤„ç†)        â”‚
                       â”‚  â””â”€â”€ AIModelCaller (APIè°ƒç”¨)            â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                     â”‚                                     â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚   AIè°ƒç”¨å±‚ (Caller)   â”‚       â”‚      æ•°æ®å±‚ (Database)  â”‚       â”‚   åŸºç¡€è®¾æ–½å±‚        â”‚
â”‚                     â”‚       â”‚                        â”‚       â”‚                   â”‚
â”‚ AIModelCaller       â”‚       â”‚ DatabaseService        â”‚       â”‚ AsyncConfig       â”‚
â”‚ â”œâ”€â”€ WebClient       â”‚       â”‚ â”œâ”€â”€ äº‹åŠ¡ç®¡ç†(@Transactional)â”‚   â”‚ â”œâ”€â”€ çº¿ç¨‹æ± é…ç½®     â”‚
â”‚ â”œâ”€â”€ ä¿¡å·é‡å¹¶å‘æ§åˆ¶    â”‚       â”‚ â”œâ”€â”€ 7è¡¨å­˜å‚¨ç­–ç•¥         â”‚       â”‚ â”œâ”€â”€ WebClientä¼˜åŒ–  â”‚
â”‚ â”œâ”€â”€ æ™ºèƒ½è¶…æ—¶ç­–ç•¥     â”‚       â”‚ â”œâ”€â”€ ä¸‰å…ƒç»„è§£æé€»è¾‘      â”‚       â”‚ â””â”€â”€ ç¼“å­˜é…ç½®       â”‚
â”‚ â”œâ”€â”€ æŒ‡æ•°é€€é¿é‡è¯•     â”‚       â”‚ â””â”€â”€ å…³ç³»è‡ªåŠ¨æ˜ å°„        â”‚       â”‚                   â”‚
â”‚ â””â”€â”€ åŠ¨æ€Promptæ„å»º   â”‚       â”‚                        â”‚       â”‚ MCPConfig         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”œâ”€â”€ SSEæœåŠ¡ç«¯      â”‚
            â”‚                               â”‚                   â”‚ â”œâ”€â”€ å·¥å…·æ³¨å†Œ       â”‚
            â”‚                               â”‚                   â”‚ â””â”€â”€ åè®®æ”¯æŒ       â”‚
            â–¼                               â–¼                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Deepseek API      â”‚       â”‚    MySQL Database      â”‚
â”‚                     â”‚       â”‚                        â”‚
â”‚ â”œâ”€â”€ deepseek-chat   â”‚       â”‚ Knowledge Graph:       â”‚
â”‚ â”œâ”€â”€ JSONå“åº”æ ¼å¼    â”‚       â”‚ â”œâ”€â”€ celebrity (åäºº)   â”‚
â”‚ â”œâ”€â”€ åŠ¨æ€è¶…æ—¶è®¡ç®—     â”‚       â”‚ â”œâ”€â”€ work (ä½œå“)        â”‚
â”‚ â””â”€â”€ æ™ºèƒ½é‡è¯•æœºåˆ¶     â”‚       â”‚ â”œâ”€â”€ event (äº‹ä»¶)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”œâ”€â”€ celebrity_celebrity â”‚
                              â”‚ â”œâ”€â”€ celebrity_work     â”‚
                              â”‚ â”œâ”€â”€ celebrity_event    â”‚
                              â”‚ â””â”€â”€ event_work         â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. æ ¸å¿ƒæ¶æ„å±‚æ¬¡

### 2.1 æ§åˆ¶å™¨å±‚ (Controller Layer)
**å•ä¸€å…¥å£è®¾è®¡**: ç²¾ç®€è‡³AsyncExtractController

```java
@RestController  
@RequestMapping("/api/v1/async")
public class AsyncExtractController {
    
    // æ ¸å¿ƒæå–æ¥å£ - å¼‚æ­¥å¤„ç†
    @PostMapping("/extract")
    public JSONObject asyncExtract(@RequestBody Map<String, Object> request);
    
    // å¥åº·æ£€æŸ¥
    @GetMapping("/health") 
    public JSONObject health();
    
    // æœåŠ¡ä¿¡æ¯
    @GetMapping("/info")
    public JSONObject info();
}
```

**ç‰¹æ€§**:
- âœ… ç«‹å³å“åº”ï¼ˆ<100msï¼‰
- âœ… å¼‚æ­¥å¤„ç†ï¼ˆåå°è‡ªåŠ¨å…¥åº“ï¼‰
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
- âœ… è·¨åŸŸæ”¯æŒ

### 2.2 ä¸šåŠ¡æœåŠ¡å±‚ (Service Layer)
**TextExtractionService**: æ ¸å¿ƒä¸šåŠ¡ç¼–æ’å™¨

```java
@Service
public class TextExtractionService {
    
    // MCPå·¥å…·æ¥å£ - Spring AIé›†æˆ
    @Tool(name = "extract_text_data")
    public String extractTextData(String textInput, String extractParams);
    
    // å¼‚æ­¥å¤„ç†å…¥å£ - ä¸“ç”¨çº¿ç¨‹æ± 
    @Async("textExtractionExecutor")
    public void processTextAsync(String textInput, String extractParams);
    
    // å¥åº·æ£€æŸ¥
    @Tool(name = "health_check") 
    public String healthCheck();
}
```

**èŒè´£**:
- ğŸ¯ **è¯·æ±‚ç¼–æ’**: åè°ƒAIå¤„ç†å’Œæ•°æ®å­˜å‚¨
- ğŸ”„ **å¼‚æ­¥ç®¡ç†**: åŸºäºçº¿ç¨‹æ± çš„å¼‚æ­¥æ‰§è¡Œ
- ğŸ› ï¸ **MCPé›†æˆ**: Spring AIå·¥å…·æ³¨å†Œå’Œè°ƒç”¨
- ğŸ“Š **ç›‘æ§é›†æˆ**: å¥åº·æ£€æŸ¥å’Œæ€§èƒ½ç»Ÿè®¡

### 2.3 AIå¤„ç†å±‚ (Provider Layer)
**SmartAIProvider**: æ™ºèƒ½AIè·¯ç”±ä¸­å¿ƒ

```java
@Component
public class SmartAIProvider {
    
    // æ™ºèƒ½ç¼“å­˜ - Caffeineæœ¬åœ°ç¼“å­˜
    private final Cache<String, String> cache = Caffeine.newBuilder()
        .maximumSize(500)
        .expireAfterWrite(1, TimeUnit.HOURS)
        .build();
    
    // æ™ºèƒ½å¤„ç†ç­–ç•¥
    public String process(String text, String extractType) {
        if (text.length() > LONG_TEXT_THRESHOLD) {
            return longTextProcessor.processLongText(text, extractType);
        } else {
            return aiCaller.callAI(text, extractType);
        }
    }
}
```

**æ ¸å¿ƒèƒ½åŠ›**:
- ğŸ§  **æ™ºèƒ½è·¯ç”±**: æ ¹æ®æ–‡æœ¬é•¿åº¦é€‰æ‹©å¤„ç†ç­–ç•¥
- âš¡ **ç¼“å­˜ä¼˜åŒ–**: Caffeineé«˜æ€§èƒ½æœ¬åœ°ç¼“å­˜
- ğŸ“„ **é•¿æ–‡æœ¬å¤„ç†**: LongTextProcessoråˆ†ç‰‡å¹¶è¡Œå¤„ç†
- ğŸ” **å“åº”éªŒè¯**: AIç»“æœæœ‰æ•ˆæ€§æ£€æŸ¥

### 2.4 é•¿æ–‡æœ¬å¤„ç†å™¨ (LongTextProcessor)
**åˆ†ç‰‡å¹¶è¡Œå¤„ç†**: ä¸“é—¨å¤„ç†è¶…é•¿æ–‡æœ¬

```java
@Service
public class LongTextProcessor {
    
    // é…ç½®å‚æ•°
    private static final int MAX_CHUNK_SIZE = 2000;
    private static final int OVERLAP_SIZE = 200; 
    private static final int MAX_PARALLEL_CHUNKS = 3;
    
    // æ ¸å¿ƒå¤„ç†æµç¨‹
    public String processLongText(String text, String extractType) {
        List<TextChunk> chunks = smartSplitText(text);
        List<CompletableFuture<ChunkResult>> futures = processInParallel(chunks);
        return mergeChunkResults(futures);
    }
}
```

**æŠ€æœ¯ç‰¹æ€§**:
- ğŸ”€ **æ™ºèƒ½åˆ†ç‰‡**: æŒ‰è¯­ä¹‰è¾¹ç•Œåˆ†å‰²ï¼Œä¿æŒä¸Šä¸‹æ–‡å®Œæ•´æ€§
- âš¡ **å¹¶è¡Œå¤„ç†**: CompletableFuture + ä¸“ç”¨çº¿ç¨‹æ± 
- ğŸ”— **ç»“æœåˆå¹¶**: æ™ºèƒ½å»é‡å’Œå…³ç³»èåˆ
- ğŸ“Š **è¿›åº¦ç›‘æ§**: å®æ—¶å¤„ç†çŠ¶æ€è·Ÿè¸ª

### 2.5 AIè°ƒç”¨å±‚ (Caller Layer)
**AIModelCaller**: ä¼˜åŒ–çš„APIè°ƒç”¨å™¨

```java
@Component
public class AIModelCaller {
    
    // å¹¶å‘æ§åˆ¶
    private final Semaphore aiCallSemaphore = new Semaphore(5);
    
    // æ™ºèƒ½è¶…æ—¶è®¡ç®—
    private Duration calculateTimeout(int textLength) {
        int timeoutSeconds = BASE_TIMEOUT_SECONDS + (textLength / 1000 * 10);
        return Duration.ofSeconds(Math.min(timeoutSeconds, MAX_TIMEOUT_SECONDS));
    }
    
    // æŒ‡æ•°é€€é¿é‡è¯•
    private Retry createSmartRetrySpec() {
        return Retry.backoff(4, Duration.ofSeconds(2))
            .maxBackoff(Duration.ofSeconds(30));
    }
}
```

**æ ¸å¿ƒä¼˜åŒ–**:
- ğŸ›¡ï¸ **å¹¶å‘æ§åˆ¶**: ä¿¡å·é‡é™åˆ¶åŒæ—¶è°ƒç”¨æ•°ï¼ˆæœ€å¤§5ä¸ªï¼‰
- â±ï¸ **åŠ¨æ€è¶…æ—¶**: æ ¹æ®æ–‡æœ¬é•¿åº¦æ™ºèƒ½è°ƒæ•´ï¼ˆ30-180ç§’ï¼‰
- ğŸ”„ **æ™ºèƒ½é‡è¯•**: æŒ‡æ•°é€€é¿ + æ¡ä»¶é‡è¯•
- ğŸŒ **è¿æ¥ä¼˜åŒ–**: WebClientè¿æ¥æ±  + å“åº”å¼å¤„ç†

### 2.6 æ•°æ®æŒä¹…åŒ–å±‚ (Database Layer)
**DatabaseService**: 7è¡¨çŸ¥è¯†å›¾è°±å­˜å‚¨

```java
@Service
@Transactional
public class DatabaseService {
    
    // 7ä¸ªRepositoryæ³¨å…¥
    @Autowired private CelebrityRepository celebrityRepository;
    @Autowired private WorkRepository workRepository;
    @Autowired private EventRepository eventRepository;
    @Autowired private CelebrityCelebrityRepository celebrityCelebrityRepository;
    @Autowired private CelebrityWorkRepository celebrityWorkRepository;
    @Autowired private CelebrityEventRepository celebrityEventRepository;
    @Autowired private EventWorkRepository eventWorkRepository;
    
    // æ™ºèƒ½ä¸‰å…ƒç»„å¤„ç†
    public void saveSocialData(String extractionResult) {
        Map<String, Object> data = parseExtractionResult(extractionResult);
        processTriplesDataWithRelations((List<Map<String, Object>>) data.get("triples"));
    }
}
```

**æ•°æ®æ¨¡å‹**:
```
çŸ¥è¯†å›¾è°±æ•°æ®æ¨¡å‹ (7è¡¨è®¾è®¡)
â”œâ”€â”€ å®ä½“è¡¨ (3å¼ )
â”‚   â”œâ”€â”€ celebrity (åäºº) - 13å­—æ®µï¼ŒåŒ…å«è¯¦ç»†ä¿¡æ¯
â”‚   â”œâ”€â”€ work (ä½œå“) - 10å­—æ®µï¼Œæ”¯æŒå¤šåª’ä½“ä½œå“
â”‚   â””â”€â”€ event (äº‹ä»¶) - 5å­—æ®µï¼Œäº‹ä»¶ç±»å‹æšä¸¾
â””â”€â”€ å…³ç³»è¡¨ (4å¼ )
    â”œâ”€â”€ celebrity_celebrity (åäººé—´å…³ç³»)
    â”œâ”€â”€ celebrity_work (åäººä½œå“å…³ç³») 
    â”œâ”€â”€ celebrity_event (åäººäº‹ä»¶å…³ç³»)
    â””â”€â”€ event_work (äº‹ä»¶ä½œå“å…³ç³»)
```

## 3. æŠ€æœ¯æ ˆå’Œé…ç½®

### 3.1 æ ¸å¿ƒæŠ€æœ¯æ ˆ
| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | ä½œç”¨ |
|------|------|------|------|
| **Webæ¡†æ¶** | Spring Boot | 3.2+ | åº”ç”¨åŸºç¡€æ¡†æ¶ |
| **AIé›†æˆ** | Spring AI | 1.0+ | MCPå·¥å…·æ”¯æŒ |
| **æ•°æ®è®¿é—®** | Spring Data JPA | 3.2+ | ORMæ˜ å°„ |
| **å¼‚æ­¥å¤„ç†** | CompletableFuture | JDK21 | å¹¶è¡Œå¤„ç† |
| **ç¼“å­˜** | Caffeine | 3.1.8 | é«˜æ€§èƒ½æœ¬åœ°ç¼“å­˜ |
| **HTTPå®¢æˆ·ç«¯** | WebClient | Spring 6+ | å“åº”å¼HTTPè°ƒç”¨ |
| **æ•°æ®åº“** | MySQL | 8.0+ | çŸ¥è¯†å›¾è°±å­˜å‚¨ |
| **è¿æ¥æ± ** | HikariCP | 5.0+ | æ•°æ®åº“è¿æ¥æ±  |
| **JSONå¤„ç†** | Jackson + FastJSON2 | 2.0+ | JSONåºåˆ—åŒ– |
| **ç›‘æ§** | Spring Actuator | 3.2+ | å¥åº·æ£€æŸ¥ |

### 3.2 å…³é”®é…ç½®å‚æ•°

```yaml
# åº”ç”¨é…ç½®
server:
  port: 2701

# æ•°æ®åº“é…ç½®  
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/base_data_graph
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver

# AIé…ç½®
extraction:
  ai:
    providers:
      deepseek:
        api-key: sk-cea6dbdbba694338b5f4abe9dfb0975b
        url: https://api.deepseek.com/v1/chat/completions
        base-timeout: 30s
        max-timeout: 180s
        max-concurrent-calls: 5

# çº¿ç¨‹æ± é…ç½®
async:
  text-extraction:
    core-pool-size: 5
    max-pool-size: 20
    queue-capacity: 100
    thread-name-prefix: "TextExtract-"

# é•¿æ–‡æœ¬å¤„ç†é…ç½®
long-text:
  threshold: 2000
  max-chunk-size: 2000
  overlap-size: 200
  max-parallel-chunks: 3
```

## 4. æ ¸å¿ƒæµç¨‹è®¾è®¡

### 4.1 å¼‚æ­¥æå–æµç¨‹
```
ç”¨æˆ·è¯·æ±‚ â†’ AsyncExtractController â†’ TextExtractionService 
    â†“
ç«‹å³è¿”å› {"success": true} (å“åº”æ—¶é—´ < 100ms)
    â†“
åå°å¼‚æ­¥çº¿ç¨‹æ± å¤„ç†:
    â†“
SmartAIProvider.process() â†’ ç¼“å­˜æ£€æŸ¥ â†’ ç­–ç•¥é€‰æ‹©
    â†“
çŸ­æ–‡æœ¬: AIModelCaller.callAI() 
é•¿æ–‡æœ¬: LongTextProcessor.processLongText()
    â†“
AIç»“æœéªŒè¯ â†’ DatabaseService.saveSocialData()
    â†“
7è¡¨çŸ¥è¯†å›¾è°±å­˜å‚¨å®Œæˆ â†’ ä»»åŠ¡ç»“æŸ
```

### 4.2 é•¿æ–‡æœ¬å¤„ç†æµç¨‹
```
æ–‡æœ¬é•¿åº¦æ£€æŸ¥ (>2000å­—ç¬¦) â†’ å¯ç”¨é•¿æ–‡æœ¬æ¨¡å¼
    â†“
smartSplitText() â†’ æ™ºèƒ½åˆ†ç‰‡ (ä¿æŒè¯­ä¹‰å®Œæ•´æ€§)
    â†“
CompletableFutureå¹¶è¡Œå¤„ç† â†’ æ¯ç‰‡ç‹¬ç«‹AIè°ƒç”¨
    â†“
ç»“æœæ”¶é›† â†’ mergeChunkResults() â†’ æ™ºèƒ½åˆå¹¶å»é‡
    â†“
ç»Ÿä¸€æ ¼å¼è¾“å‡º â†’ æ•°æ®åº“å­˜å‚¨
```

### 4.3 ç¼“å­˜ç­–ç•¥
```
Caffeineæœ¬åœ°ç¼“å­˜æ¶æ„:
â”œâ”€â”€ ç¼“å­˜é”®ç”Ÿæˆ: text + extractType â†’ hash
â”œâ”€â”€ ç¼“å­˜å¤§å°: æœ€å¤§500ä¸ªæ¡ç›®
â”œâ”€â”€ è¿‡æœŸç­–ç•¥: å†™å…¥å1å°æ—¶è¿‡æœŸ
â”œâ”€â”€ å‘½ä¸­ç‡ç»Ÿè®¡: å®æ—¶ç›‘æ§ç¼“å­˜æ•ˆæœ
â””â”€â”€ é¢„çƒ­æœºåˆ¶: æ”¯æŒå¸¸ç”¨æ–‡æœ¬é¢„å¤„ç†
```

## 5. æ€§èƒ½å’Œç›‘æ§

### 5.1 æ€§èƒ½æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®é™…è¡¨ç° |
|------|--------|----------|
| **å“åº”æ—¶é—´** | <100ms | 50-80ms |
| **å¹¶å‘å¤„ç†** | 5ä¸ªAIè°ƒç”¨ | ä¿¡å·é‡æ§åˆ¶ |
| **ç¼“å­˜å‘½ä¸­ç‡** | >80% | Caffeineç»Ÿè®¡ |
| **é•¿æ–‡æœ¬å¤„ç†** | <3åˆ†é’Ÿ | åˆ†ç‰‡å¹¶è¡Œä¼˜åŒ– |
| **æ•°æ®åº“äº‹åŠ¡** | <1ç§’ | æ‰¹é‡æ“ä½œä¼˜åŒ– |

### 5.2 ç›‘æ§ä½“ç³»
```java
// å¥åº·æ£€æŸ¥æ¥å£
GET /api/v1/async/health
{
  "status": "healthy",
  "memory_usage": "45.67%",
  "cache_size": 156,
  "database_enabled": true
}

// æœåŠ¡ä¿¡æ¯æ¥å£  
GET /api/v1/async/info
{
  "service": "async-extract-service",
  "version": "1.0.0", 
  "thread_pool_config": {
    "core_pool_size": 5,
    "max_pool_size": 20
  }
}
```

### 5.3 é”™è¯¯å¤„ç†å’Œæ¢å¤
- **AIè°ƒç”¨å¤±è´¥**: æŒ‡æ•°é€€é¿é‡è¯• â†’ é™çº§å¤„ç† â†’ é”™è¯¯å“åº”
- **æ•°æ®åº“å¼‚å¸¸**: äº‹åŠ¡å›æ»š â†’ æ—¥å¿—è®°å½• â†’ é‡è¯•æœºåˆ¶
- **å†…å­˜ä¸è¶³**: ç¼“å­˜æ¸…ç† â†’ GCè§¦å‘ â†’ ç›‘æ§å‘Šè­¦
- **å¹¶å‘è¶…é™**: ä¿¡å·é‡é˜»å¡ â†’ é˜Ÿåˆ—ç­‰å¾… â†’ è¶…æ—¶å¤„ç†

## 6. éƒ¨ç½²å’Œè¿ç»´

### 6.1 éƒ¨ç½²æ¶æ„
```
ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²:
â”œâ”€â”€ åº”ç”¨æœåŠ¡å™¨: 8æ ¸16Gå†…å­˜
â”œâ”€â”€ MySQLæ•°æ®åº“: ä¸»ä»å¤åˆ¶ + è¯»å†™åˆ†ç¦»
â”œâ”€â”€ ç›‘æ§ç³»ç»Ÿ: Prometheus + Grafana
â”œâ”€â”€ æ—¥å¿—ç³»ç»Ÿ: ELK Stack
â””â”€â”€ åå‘ä»£ç†: Nginx + SSL
```

### 6.2 è¿ç»´ç‰¹æ€§
- **é›¶åœæœºéƒ¨ç½²**: Spring Bootä¼˜é›…å…³é—­
- **é…ç½®çƒ­æ›´æ–°**: @RefreshScopeæ”¯æŒ
- **æ—¥å¿—åˆ†çº§**: å¼‚æ­¥æ—¥å¿— + æ–‡ä»¶è½®è½¬
- **ç›‘æ§å‘Šè­¦**: è‡ªå®šä¹‰æŒ‡æ ‡ + é˜ˆå€¼å‘Šè­¦
- **å¤‡ä»½æ¢å¤**: æ•°æ®åº“å®šæ—¶å¤‡ä»½ + å¢é‡æ¢å¤

## 7. æ¶æ„ä¼˜åŠ¿å’Œç‰¹ç‚¹

### 7.1 è®¾è®¡ä¼˜åŠ¿
1. **é«˜æ€§èƒ½**: 
   - Caffeineç¼“å­˜å‡å°‘80%é‡å¤è®¡ç®—
   - ä¿¡å·é‡æ§åˆ¶é˜²æ­¢èµ„æºè¿‡è½½
   - å¼‚æ­¥å¤„ç†æå‡ç”¨æˆ·ä½“éªŒ

2. **é«˜å¯ç”¨**:
   - æ™ºèƒ½é‡è¯•æœºåˆ¶æå‡æˆåŠŸç‡
   - ä¼˜é›…é™çº§é¿å…ç³»ç»Ÿå´©æºƒ
   - äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§

3. **é«˜æ‰©å±•**:
   - åˆ†å±‚æ¶æ„ä¾¿äºåŠŸèƒ½æ‰©å±•
   - ç­–ç•¥æ¨¡å¼æ”¯æŒå¤šAIæä¾›è€…
   - å¼‚æ­¥çº¿ç¨‹æ± æ”¯æŒæ°´å¹³æ‰©å±•

### 7.2 æŠ€æœ¯ç‰¹ç‚¹
- **å“åº”å¼ç¼–ç¨‹**: WebClient + CompletableFuture
- **å‡½æ•°å¼è®¾è®¡**: Lambda + Stream API  
- **æ³¨è§£é©±åŠ¨**: Spring Boot + Spring AI
- **é…ç½®å¤–åŒ–**: YAMLé…ç½® + ç¯å¢ƒå˜é‡
- **ç›‘æ§å‹å¥½**: Actuator + è‡ªå®šä¹‰æŒ‡æ ‡

## 8. ä¸‹ä¸€æ­¥è§„åˆ’

### 8.1 åŠŸèƒ½å¢å¼º
- [ ] å¤šæ¨¡æ€æ”¯æŒï¼ˆå›¾ç‰‡+æ–‡æœ¬ï¼‰
- [ ] å®ä½“é“¾æ¥ï¼ˆå¤–éƒ¨çŸ¥è¯†åº“ï¼‰
- [ ] å…³ç³»æ¨ç†ï¼ˆå›¾ç¥ç»ç½‘ç»œï¼‰
- [ ] æ‰¹å¤„ç†ä¼˜åŒ–ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰

### 8.2 æ€§èƒ½ä¼˜åŒ–
- [ ] åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆRedis Clusterï¼‰
- [ ] æ•°æ®åº“ä¼˜åŒ–ï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰
- [ ] AIè°ƒç”¨ä¼˜åŒ–ï¼ˆæ¨¡å‹æœ¬åœ°åŒ–ï¼‰
- [ ] è´Ÿè½½å‡è¡¡ï¼ˆå¤šå®ä¾‹éƒ¨ç½²ï¼‰

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£ä¸ä»£ç åŒæ­¥æ›´æ–°ï¼Œåæ˜ ç³»ç»ŸçœŸå®æ¶æ„çŠ¶æ€
 