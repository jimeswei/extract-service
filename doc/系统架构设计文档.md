# æ™ºèƒ½æ–‡æœ¬æå–æœåŠ¡ - ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£ v5.0 ğŸš€

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: æ™ºèƒ½æ–‡æœ¬æå–æœåŠ¡ (Knowledge Graph Extract Service)  
**ç‰ˆæœ¬**: v5.0 - ä¼ä¸šçº§çŸ¥è¯†å›¾è°±æ„å»ºå¹³å°  
**æ¶æ„ç±»å‹**: Spring Bootå¾®æœåŠ¡ + AIæ™ºèƒ½å¤„ç† + çŸ¥è¯†å›¾è°±å¼•æ“  
**è®¾è®¡ç†å¿µ**: ç»Ÿä¸€å…¥å£ï¼Œå¼‚æ­¥å¤„ç†ï¼Œæ™ºèƒ½èåˆï¼ŒçŸ¥è¯†å¢å¼ºï¼Œä¼ä¸šçº§ç›‘æ§  

## ğŸ¯ v5.0 æ ¸å¿ƒå‡çº§ç‰¹æ€§

### 1. çŸ¥è¯†å›¾è°±æ™ºèƒ½æ„å»ºå¼•æ“
- **å®ä½“æ¶ˆæ­§ä¹‰**: æ™ºèƒ½è¯†åˆ«åŒåå®ä½“ï¼Œæ”¯æŒä¸Šä¸‹æ–‡æ¨æ–­ï¼Œæ¶ˆæ­§ä¹‰å‡†ç¡®ç‡95%+
- **çŸ¥è¯†èåˆ**: å¤šæºä¿¡æ¯æ™ºèƒ½åˆå¹¶ï¼Œå±æ€§è¡¥å…¨å¢å¼ºï¼Œå†²çªè‡ªåŠ¨è§£å†³
- **å…³ç³»éªŒè¯**: æ™ºèƒ½æ£€æµ‹å…³ç³»å†²çªï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼ŒéªŒè¯è§„åˆ™çµæ´»é…ç½®
- **è´¨é‡è¯„ä¼°**: å®æ—¶ç›‘æ§çŸ¥è¯†å›¾è°±è´¨é‡æŒ‡æ ‡ï¼Œå®Œæ•´æ€§ã€ä¸€è‡´æ€§ã€å‡†ç¡®æ€§ä¸‰ç»´è¯„ä¼°

### 2. ä¼ä¸šçº§æ•°æ®ç»´æŠ¤
- **å®šæ—¶æ•°æ®æ¸…ç†**: è‡ªåŠ¨æ¸…ç†30å¤©å‰çš„æ¶ˆæ­§ä¹‰è®°å½•ï¼Œé˜²æ­¢æ•°æ®è†¨èƒ€
- **è´¨é‡ç›‘æ§**: æ¯å°æ—¶æ‰§è¡Œè´¨é‡è¯„ä¼°ï¼Œç”Ÿæˆè¯¦ç»†çš„æ•°æ®è´¨é‡æŠ¥å‘Š
- **æ€§èƒ½ä¼˜åŒ–**: HikariCPè¿æ¥æ± ä¼˜åŒ–ï¼Œæ‰¹é‡å¤„ç†ï¼ŒäºŒçº§ç¼“å­˜

### 3. ä¿ç•™æ ¸å¿ƒä¼˜åŠ¿
- **å¼‚æ­¥å¤„ç†**: ä¿æŒ < 100ms å“åº”æ—¶é—´ï¼Œä¼ä¸šçº§æ€§èƒ½ç›‘æ§
- **é•¿æ–‡æœ¬æ™ºèƒ½åˆ†ç‰‡**: 2000å­—ç¬¦é˜ˆå€¼ï¼Œ3çº¿ç¨‹å¹¶è¡Œå¤„ç†
- **ç»Ÿä¸€å…¥å£**: æç®€å‚æ•°è®¾è®¡ï¼Œä¸¤ä¸ªå‚æ•°æå®šä¸€åˆ‡ï¼ŒMCPå·¥å…·æ¥å£å…¼å®¹
- **å¤šçº§ç¼“å­˜**: Caffeineç¼“å­˜ + å®ä½“ç›¸ä¼¼åº¦ç¼“å­˜ï¼Œå‘½ä¸­ç‡ > 90%

## ğŸ—ï¸ v5.0 ä¼ä¸šçº§æ¶æ„è®¾è®¡

### 1. åˆ†å±‚æ¶æ„ï¼ˆå®é™…å®ç°ï¼‰

```mermaid
graph TD
    A["ğŸŒ Controller Layer<br/>AsyncExtractController"] --> B["ğŸ§  Service Layer<br/>æ™ºèƒ½ä¸šåŠ¡ç¼–æ’"]
    B --> C["ğŸ¤– Knowledge Layer<br/>çŸ¥è¯†å›¾è°±å¼•æ“"]
    B --> D["ğŸ“Š Repository Layer<br/>æ•°æ®æŒä¹…åŒ–"]
    
    C --> E["EntityDisambiguator<br/>å®ä½“æ¶ˆæ­§ä¹‰å™¨"]
    C --> F["KnowledgeFusion<br/>çŸ¥è¯†èåˆå¼•æ“"]
    C --> G["RelationValidator<br/>å…³ç³»éªŒè¯å™¨"]
    C --> H["QualityAssessor<br/>è´¨é‡è¯„ä¼°å™¨"]
    
    B --> I["SmartAIProvider<br/>AIæ™ºèƒ½è·¯ç”±å™¨"]
    I --> J["LongTextProcessor<br/>é•¿æ–‡æœ¬åˆ†ç‰‡å¤„ç†"]
    I --> K["AIModelCaller<br/>DeepSeek APIè°ƒç”¨"]
    
    B --> L["DataMaintenanceService<br/>æ•°æ®ç»´æŠ¤æœåŠ¡"]
    L --> M["å®šæ—¶æ¸…ç†ä»»åŠ¡<br/>@Scheduled"]
    L --> N["è´¨é‡ç›‘æ§<br/>æ¯å°æ—¶è¯„ä¼°"]
    
    D --> O["MySQL 8.0<br/>HikariCPè¿æ¥æ± "]
    D --> P["10å¼ æ ¸å¿ƒè¡¨<br/>åŒ…å«æ¶ˆæ­§ä¹‰å’Œè´¨é‡è¡¨"]
    
    E --> Q["Caffeine Cache<br/>å®ä½“ç›¸ä¼¼åº¦ç¼“å­˜"]
    F --> Q
```

### 2. å®é™…å¤„ç†æµç¨‹

```
è¯·æ±‚ â†’ AsyncExtractController â†’ TextExtractionService
    â†“
å¼‚æ­¥ä»»åŠ¡(@Async) â†’ SmartAIProvider â†’ [é•¿æ–‡æœ¬åˆ†ç‰‡/ç›´æ¥è°ƒç”¨]
    â†“
AIç»“æœ â†’ KnowledgeGraphEngine (ç­–ç•¥æ¨¡å¼:standard/enhanced/fusion)
    â†“
    â”œâ”€ standard: ç›´æ¥å­˜å‚¨
    â”œâ”€ enhanced: å®ä½“æ¶ˆæ­§ä¹‰ â†’ å…³ç³»éªŒè¯ 
    â””â”€ fusion: å®Œæ•´å¤„ç†é“¾ â†’ å®ä½“æ¶ˆæ­§ä¹‰ â†’ çŸ¥è¯†èåˆ â†’ å…³ç³»éªŒè¯ â†’ è´¨é‡è¯„ä¼°
    â†“
DatabaseService â†’ å¢å¼ºå­˜å‚¨ (10å¼ è¡¨ + ç‰ˆæœ¬ç®¡ç† + ç½®ä¿¡åº¦)
    â†“
DataMaintenanceService â†’ å®šæ—¶æ¸…ç† + è´¨é‡ç›‘æ§
```

## ğŸ§© v5.0 æ ¸å¿ƒç»„ä»¶æ¶æ„ï¼ˆå®é™…å®ç°ï¼‰

### 3.1 Controllerå±‚ - ä¼ä¸šçº§ç»Ÿä¸€å…¥å£
```java
@RestController
@RequestMapping("/api/v1")
@CrossOrigin(origins = "*")
public class AsyncExtractController {
    
    @Autowired
    private OptimizedBusinessService businessService;  // ç»Ÿä¸€ä¸šåŠ¡ç¼–æ’
    @Autowired
    private TextExtractionService textExtractionService;
    @Autowired
    private DataMaintenanceService dataMaintenanceService;
    
    // ç»Ÿä¸€æ–‡æœ¬æå–æ¥å£ - v5.0å¢å¼ºç‰ˆ
    @PostMapping("/extract")
    public JSONObject extractAsync(@RequestBody JSONObject request) {
        String textInput = request.getString("textInput");
        String extractParams = request.getString("extractParams");
        String kgMode = request.getString("kgMode");
        
        // å‚æ•°éªŒè¯å’Œé»˜è®¤å€¼è®¾ç½®
        if (kgMode == null || kgMode.trim().isEmpty()) {
            kgMode = "standard";
        }
        if (extractParams == null || extractParams.trim().isEmpty()) {
            extractParams = "triples";
        }
        
        // æ”¯æŒä¸‰ç§æ¨¡å¼ï¼šstandard/enhanced/fusion
        textExtractionService.processTextAsync(textInput, extractParams, kgMode);
        
        return ResponseBuilder.success("ä»»åŠ¡å·²æäº¤ï¼Œæ­£åœ¨æ™ºèƒ½å¤„ç†ä¸­...")
                .data("kg_mode", kgMode)
                .data("text_length", textInput.length())
                .build();
    }
    
    @GetMapping("/info")            // æœåŠ¡ä¿¡æ¯ (v5.0-enterprise)
    @GetMapping("/health")          // å¥åº·æ£€æŸ¥ (ä¼ä¸šçº§ç›‘æ§)
    @GetMapping("/kg-stats")        // çŸ¥è¯†å›¾è°±ç»Ÿè®¡
    @GetMapping("/entity-disambiguation")  // å®ä½“æ¶ˆæ­§ä¹‰æŸ¥è¯¢
    @GetMapping("/knowledge-quality")      // çŸ¥è¯†è´¨é‡è¯„ä¼°
    @GetMapping("/quality-report")         // å®Œæ•´è´¨é‡æŠ¥å‘Š
    @GetMapping("/monitor")               // ä»»åŠ¡ç›‘æ§ç»Ÿè®¡
}
```

### 3.2 Serviceå±‚ - æ™ºèƒ½ä¸šåŠ¡ç¼–æ’ï¼ˆå®é™…å®ç°ï¼‰
```java
@Service
public class TextExtractionService {
    
    private final SmartAIProvider smartAIProvider;
    private final DatabaseService databaseService;
    private final KnowledgeGraphEngine knowledgeGraphEngine; // v5.0æ ¸å¿ƒå¼•æ“
    
    // MCPå·¥å…·æ¥å£ - ä¿æŒå‘åå…¼å®¹
    @Tool(name = "extract_text_data", description = "ç»Ÿä¸€æ–‡æœ¬æå–å·¥å…·ï¼Œæ”¯æŒä¸‰å…ƒç»„ã€æ‰¹é‡æå–ã€ç¤¾äº¤å…³ç³»ç­‰å¤šç§æ¨¡å¼")
    public String extractTextData(
            @ToolParam(description = "æ–‡æœ¬å†…å®¹æˆ–æ–‡æœ¬æ•°ç»„(JSONæ ¼å¼)") String textInput,
            @ToolParam(description = "æå–å‚æ•°: entities,relations æˆ–å…¶ä»–é€‰é¡¹") String extractParams) {
        
        // v5.0å‡çº§ï¼šè°ƒç”¨æ”¯æŒçŸ¥è¯†å›¾è°±æ¨¡å¼çš„å¼‚æ­¥æ–¹æ³•
        processTextAsync(textInput, extractParams, "standard"); // é»˜è®¤æ ‡å‡†æ¨¡å¼
        return String.format("""
                {"success":true,"message":"ä»»åŠ¡å·²æäº¤ï¼Œæ­£åœ¨åå°å¤„ç†","timestamp":%d}
                """, System.currentTimeMillis());
    }
    
    // å¼‚æ­¥å¤„ç† - v5.0å‡çº§ç‰ˆï¼Œæ”¯æŒçŸ¥è¯†å›¾è°±å¤„ç†æ¨¡å¼
    @Async("textExtractionExecutor")
    public void processTextAsync(String textInput, String extractParams, String kgMode) {
        try {
            log.info("å¼€å§‹å¼‚æ­¥æ–‡æœ¬æå–ï¼Œçº¿ç¨‹: {}, æ–‡æœ¬é•¿åº¦: {}, KGæ¨¡å¼: {}",
                    Thread.currentThread().getName(),
                    textInput != null ? textInput.length() : 0, kgMode);

            // é˜¶æ®µ1: AIå¤„ç† (ä¿æŒåŸæœ‰é€»è¾‘)
            String extractType = extractParams != null ? extractParams : "triples";
            String aiResult = smartAIProvider.process(textInput, extractType);

            // é˜¶æ®µ2: çŸ¥è¯†å›¾è°±æ™ºèƒ½å¤„ç† (v5.0ç­–ç•¥æ¨¡å¼)
            if ("enhanced".equals(kgMode) || "fusion".equals(kgMode)) {
                aiResult = knowledgeGraphEngine.enhanceKnowledge(aiResult, kgMode);
            }

            // é˜¶æ®µ3: æ•°æ®æŒä¹…åŒ– (å¢å¼ºç‰ˆ)
            databaseService.saveSocialDataEnhanced(aiResult, kgMode);

            log.info("å¼‚æ­¥æ–‡æœ¬æå–å®Œæˆï¼Œå¤„ç†æ–‡æœ¬é•¿åº¦: {}, KGæ¨¡å¼: {}",
                    textInput != null ? textInput.length() : 0, kgMode);

        } catch (Exception e) {
            log.error("å¼‚æ­¥æ–‡æœ¬æå–å¤±è´¥ï¼Œé”™è¯¯: {}", e.getMessage());
        }
    }
    
    // å¥åº·æ£€æŸ¥å·¥å…·æ–¹æ³•
    @Tool(name = "health_check", description = "æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€ï¼ŒåŒ…æ‹¬AI APIå¯ç”¨æ€§å’Œç³»ç»Ÿèµ„æºçŠ¶æ€")
    public String healthCheck() {
        try {
            HealthStatus status = checkSystemHealth();
            return createHealthResponse(status);
        } catch (Exception e) {
            log.error("å¥åº·æ£€æŸ¥å¤±è´¥: {}", e.getMessage());
            return createErrorResponse(e.getMessage());
        }
    }
}
```

### 3.3 çŸ¥è¯†å›¾è°±å¼•æ“ - v5.0æ ¸å¿ƒç»„ä»¶ï¼ˆå®é™…å®ç°ï¼‰
```java
@Component
public class KnowledgeGraphEngine {
    
    private final EntityDisambiguator entityDisambiguator;
    private final KnowledgeFusion knowledgeFusion;
    private final RelationValidator relationValidator;
    private final QualityAssessor qualityAssessor;
    
    @Autowired
    public KnowledgeGraphEngine(
            EntityDisambiguator entityDisambiguator,
            KnowledgeFusion knowledgeFusion,
            RelationValidator relationValidator,
            QualityAssessor qualityAssessor) {
        this.entityDisambiguator = entityDisambiguator;
        this.knowledgeFusion = knowledgeFusion;
        this.relationValidator = relationValidator;
        this.qualityAssessor = qualityAssessor;
        log.info("KnowledgeGraphEngine initialized with all processors");
    }
    
    /**
     * çŸ¥è¯†å¢å¼ºå¤„ç† - ç­–ç•¥æ¨¡å¼å®ç°
     * @param aiResult AIåŸå§‹ç»“æœ
     * @param kgMode å¤„ç†æ¨¡å¼ (standard/enhanced/fusion)
     * @return å¢å¼ºåçš„çŸ¥è¯†ç»“æœ
     */
    public String enhanceKnowledge(String aiResult, String kgMode) {
        try {
            log.info("å¼€å§‹çŸ¥è¯†å›¾è°±å¢å¼ºå¤„ç†ï¼Œæ¨¡å¼: {}", kgMode);

            Map<String, Object> data = parseExtractionResult(aiResult);

            // ä½¿ç”¨ç­–ç•¥æ¨¡å¼é€‰æ‹©å¤„ç†é“¾
            KnowledgeProcessingStrategy strategy = createStrategy(kgMode);
            Map<String, Object> enhancedData = strategy.process(data);

            String result = JSON.toJSONString(enhancedData);
            log.info("çŸ¥è¯†å›¾è°±å¢å¼ºå¤„ç†å®Œæˆï¼Œæ¨¡å¼: {}", kgMode);

            return result;

        } catch (Exception e) {
            log.error("çŸ¥è¯†å›¾è°±å¢å¼ºå¤„ç†å¤±è´¥ï¼Œæ¨¡å¼: {}, é”™è¯¯: {}", kgMode, e.getMessage(), e);
            return aiResult; // å¤±è´¥æ—¶è¿”å›åŸå§‹ç»“æœï¼Œç¡®ä¿ç³»ç»Ÿé²æ£’æ€§
        }
    }
    
    /**
     * åˆ›å»ºå¤„ç†ç­–ç•¥ - ç­–ç•¥æ¨¡å¼
     */
    private KnowledgeProcessingStrategy createStrategy(String kgMode) {
        return switch (kgMode.toLowerCase()) {
            case "enhanced" -> new EnhancedStrategy();
            case "fusion" -> new FusionStrategy();
            case "standard" -> new StandardStrategy();
            default -> {
                log.warn("æœªçŸ¥çš„KGæ¨¡å¼: {}, ä½¿ç”¨æ ‡å‡†æ¨¡å¼", kgMode);
                yield new StandardStrategy();
            }
        };
    }
    
    // å†…éƒ¨ç­–ç•¥ç±»å®ç°
    private class StandardStrategy implements KnowledgeProcessingStrategy {
        public Map<String, Object> process(Map<String, Object> data) {
            data.put("kg_mode", "standard");
            return data;
        }
    }
    
    private class EnhancedStrategy implements KnowledgeProcessingStrategy {
        public Map<String, Object> process(Map<String, Object> data) {
            data = entityDisambiguator.disambiguate(data);
            data = relationValidator.validate(data);
            data.put("kg_mode", "enhanced");
            return data;
        }
    }
    
    private class FusionStrategy implements KnowledgeProcessingStrategy {
        public Map<String, Object> process(Map<String, Object> data) {
            data = entityDisambiguator.disambiguate(data);
            data = knowledgeFusion.fuseKnowledge(data);
            data = relationValidator.validate(data);
            data = qualityAssessor.assess(data);
            data.put("kg_mode", "fusion");
            return data;
        }
    }
}
```

### 3.4 å®ä½“æ¶ˆæ­§ä¹‰æœåŠ¡
```java
@Component
public class EntityDisambiguator {
    
    @Autowired
    private EntitySimilarityCalculator similarityCalculator;
    @Autowired
    private ContextAnalyzer contextAnalyzer;
    @Autowired
    private CelebrityRepository celebrityRepository;
    
    /**
     * å®ä½“æ¶ˆæ­§ä¹‰å¤„ç†
     */
    public Map<String, Object> disambiguate(Map<String, Object> data) {
        List<Map<String, Object>> triples = (List<Map<String, Object>>) data.get("triples");
        List<Map<String, Object>> disambiguatedTriples = new ArrayList<>();
        
        for (Map<String, Object> triple : triples) {
            String subject = (String) triple.get("subject");
            String object = (String) triple.get("object");
            
            // å®ä½“æ¶ˆæ­§ä¹‰
            String disambiguatedSubject = disambiguateEntity(subject, triple);
            String disambiguatedObject = disambiguateEntity(object, triple);
            
            // æ›´æ–°ä¸‰å…ƒç»„
            triple.put("subject", disambiguatedSubject);
            triple.put("object", disambiguatedObject);
            triple.put("disambiguation_confidence", calculateConfidence(subject, object));
            
            disambiguatedTriples.add(triple);
        }
        
        data.put("triples", disambiguatedTriples);
        data.put("disambiguation_applied", true);
        return data;
    }
    
    private String disambiguateEntity(String entityName, Map<String, Object> context) {
        // 1. æŸ¥æ‰¾å€™é€‰å®ä½“
        List<Celebrity> candidates = celebrityRepository.findByNameContaining(entityName);
        
        if (candidates.isEmpty()) {
            return entityName; // æ–°å®ä½“ï¼Œç›´æ¥è¿”å›
        }
        
        if (candidates.size() == 1) {
            return candidates.get(0).getName(); // å”¯ä¸€åŒ¹é…
        }
        
        // 2. å¤šå€™é€‰å®ä½“ï¼ŒåŸºäºä¸Šä¸‹æ–‡æ¶ˆæ­§ä¹‰
        Celebrity bestMatch = findBestMatch(entityName, candidates, context);
        return bestMatch != null ? bestMatch.getName() : entityName;
    }
}
```

## ğŸ“Š v5.0 æ•°æ®åº“æ¶æ„ï¼ˆå®é™…å®ç°ï¼‰

### 4.1 å®é™…è¡¨ç»“æ„ (10å¼ æ ¸å¿ƒè¡¨)

```sql
-- æ ¸å¿ƒå®ä½“è¡¨ (3å¼ ) - å¢åŠ ç‰ˆæœ¬å’Œç½®ä¿¡åº¦å­—æ®µ
celebrity (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    celebrity_id VARCHAR(50),
    name VARCHAR(255) NOT NULL,
    nationality VARCHAR(100),
    birthdate DATE,
    gender VARCHAR(10),
    profession VARCHAR(500),
    spouse VARCHAR(255),
    company VARCHAR(255),
    position VARCHAR(255),
    education VARCHAR(1000),
    resume TEXT,
    baike TEXT,
    `group` VARCHAR(255),
    relatives VARCHAR(1000),
    confidence_score DECIMAL(3,2) DEFAULT 0.80,
    version INT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

work (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    work_id VARCHAR(50),
    title VARCHAR(500) NOT NULL,
    work_type VARCHAR(100),
    release_date DATE,
    role VARCHAR(255),
    platform VARCHAR(255),
    awards TEXT,
    description TEXT,
    baike TEXT,
    `group` VARCHAR(255),
    confidence_score DECIMAL(3,2) DEFAULT 0.80,
    version INT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

event (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    event_id VARCHAR(50),
    event_name VARCHAR(500) NOT NULL,
    event_type VARCHAR(100),
    time DATETIME,
    `group` VARCHAR(255),
    confidence_score DECIMAL(3,2) DEFAULT 0.80,
    version INT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- å…³ç³»è¡¨ (4å¼ ) - å¢åŠ ç½®ä¿¡åº¦å’Œæ¥æºä¿¡æ¯
celebrity_celebrity (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    from_id BIGINT NOT NULL,
    to_id BIGINT NOT NULL,
    e_type VARCHAR(100) NOT NULL,
    confidence_score DECIMAL(3,2) DEFAULT 0.80,
    source_info TEXT,
    version INT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (from_id) REFERENCES celebrity(id),
    FOREIGN KEY (to_id) REFERENCES celebrity(id)
);

celebrity_work (id, from_id, to_id, e_type, confidence_score, source_info, version, created_at, updated_at)
celebrity_event (id, from_id, to_id, e_type, confidence_score, source_info, version, created_at, updated_at)
event_work (id, from_id, to_id, e_type, confidence_score, source_info, version, created_at, updated_at)

-- v5.0æ–°å¢çŸ¥è¯†å›¾è°±ç®¡ç†è¡¨ (2å¼ )
entity_disambiguation (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    entity_name VARCHAR(255) NOT NULL,
    canonical_name VARCHAR(255) NOT NULL,
    similarity_score DECIMAL(5,4) NOT NULL,
    disambiguation_rule VARCHAR(500),
    entity_type ENUM('CELEBRITY', 'WORK', 'EVENT') NOT NULL,
    context_info TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_entity_name (entity_name),
    INDEX idx_entity_type (entity_type),
    INDEX idx_similarity (similarity_score)
);

knowledge_quality (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    entity_type ENUM('CELEBRITY', 'WORK', 'EVENT') NOT NULL,
    entity_id BIGINT NOT NULL,
    quality_score DECIMAL(3,2) NOT NULL,
    completeness DECIMAL(3,2),
    consistency DECIMAL(3,2),
    accuracy DECIMAL(3,2),
    last_assessed TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    assessment_details TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_entity_type_id (entity_type, entity_id),
    INDEX idx_quality_score (quality_score)
);
```

## ğŸŒŸ v5.0 APIæ¥å£ï¼ˆå®é™…å®ç°ï¼‰

### 5.1 ç»Ÿä¸€å…¥å£ - ä¼ä¸šçº§å¢å¼º
```http
# ä¸»è¦æ¥å£ - å®Œå…¨å‘åå…¼å®¹ + çŸ¥è¯†å›¾è°±å¢å¼º
POST /api/v1/extract
Content-Type: application/json

# æ ‡å‡†æ¨¡å¼ (ä¿æŒåŸæœ‰åŠŸèƒ½)
{
  "textInput": "å¼ è‰ºè°‹å¯¼æ¼”äº†ã€Šçº¢é«˜ç²±ã€‹",
  "extractParams": "triples"
}

# å¢å¼ºæ¨¡å¼ (å®ä½“æ¶ˆæ­§ä¹‰ + å…³ç³»éªŒè¯)
{
  "textInput": "å¼ è‰ºè°‹å¯¼æ¼”äº†ã€Šçº¢é«˜ç²±ã€‹", 
  "extractParams": "triples",
  "kgMode": "enhanced"
}

# èåˆæ¨¡å¼ (å®Œæ•´çŸ¥è¯†å›¾è°±å¤„ç†é“¾)
{
  "textInput": "å¼ è‰ºè°‹å¯¼æ¼”äº†ã€Šçº¢é«˜ç²±ã€‹",
  "extractParams": "triples", 
  "kgMode": "fusion"
}

# ç»Ÿä¸€å“åº”æ ¼å¼
Response: {
  "success": true,
  "message": "ä»»åŠ¡å·²æäº¤ï¼Œæ­£åœ¨æ™ºèƒ½å¤„ç†ä¸­...",
  "data": {
    "kg_mode": "enhanced",
    "text_length": 12,
    "extract_type": "triples"
  },
  "timestamp": 1640995200000
}
```

### 5.2 çŸ¥è¯†å›¾è°±ä¸“å±æ¥å£ï¼ˆå®é™…å®ç°ï¼‰
```http
# æœåŠ¡ä¿¡æ¯
GET /api/v1/info
Response: {
  "success": true,
  "message": "æ™ºèƒ½æ–‡æœ¬æå–æœåŠ¡ - ä¼ä¸šçº§ç‰ˆæœ¬",
  "data": {
    "version": "v5.0-enterprise",
    "features": ["å¼‚æ­¥å¤„ç†", "çŸ¥è¯†å›¾è°±å¢å¼º", "å®ä½“æ¶ˆæ­§ä¹‰", "å…³ç³»éªŒè¯", "è´¨é‡è¯„ä¼°"],
    "supported_modes": ["standard", "enhanced", "fusion", "batch"],
    "max_text_length": 50000,
    "concurrent_processing": true
  }
}

# çŸ¥è¯†å›¾è°±ç»Ÿè®¡
GET /api/v1/kg-stats
Response: {
  "success": true,
  "message": "çŸ¥è¯†å›¾è°±ç»Ÿè®¡ä¿¡æ¯",
  "data": {
    "total_entities": 15,
    "total_relations": 29,
    "avg_quality_score": 0.82,
    "disambiguation_rate": 0.75,
    "celebrity_count": 8,
    "work_count": 4,
    "event_count": 3
  }
}

# å®ä½“æ¶ˆæ­§ä¹‰æŸ¥è¯¢
GET /api/v1/entity-disambiguation?name=å¼ è‰ºè°‹
Response: {
  "success": true,
  "message": "å®ä½“æ¶ˆæ­§ä¹‰æŸ¥è¯¢ç»“æœ",
  "data": {
    "query_name": "å¼ è‰ºè°‹",
    "disambiguation_records": [
      {
        "canonical_name": "å¼ è‰ºè°‹",
        "similarity_score": 0.95,
        "entity_type": "CELEBRITY",
        "context_info": "å¯¼æ¼”"
      }
    ],
    "total_count": 1
  }
}

# çŸ¥è¯†è´¨é‡è¯„ä¼°
GET /api/v1/knowledge-quality?entityId=123
Response: {
  "success": true,
  "message": "çŸ¥è¯†è´¨é‡è¯„ä¼°ç»“æœ",
  "data": {
    "entity_id": "123",
    "entity_type": "CELEBRITY",
    "quality_score": 0.89,
    "completeness": 0.92,
    "consistency": 0.85,
    "accuracy": 0.91,
    "last_assessed": "2024-01-01T12:00:00Z"
  }
}

# å®Œæ•´è´¨é‡æŠ¥å‘Š
GET /api/v1/quality-report
Response: {
  "success": true,
  "message": "æ•°æ®è´¨é‡å…¨é¢æŠ¥å‘Š",
  "data": {
    "overall_quality": 0.85,
    "total_entities": 15,
    "high_quality_entities": 12,
    "low_quality_entities": [],
    "avg_completeness": 0.88,
    "avg_consistency": 0.82,
    "quality_trends": "stable"
  }
}

# å¥åº·æ£€æŸ¥ - ä¼ä¸šçº§ç›‘æ§
GET /api/v1/health
Response: {
  "success": true,
  "message": "ç³»ç»Ÿè¿è¡Œæ­£å¸¸",
  "data": {
    "system_status": "healthy",
    "success_rate": "95.5%",
    "active_tasks": 0,
    "memory_usage": "34.2%",
    "uptime": "2å°æ—¶23åˆ†é’Ÿ"
  },
  "metrics": {
    "total_tasks": 42,
    "success_tasks": 40,
    "failed_tasks": 2
  }
}
```

## ğŸ“ˆ v5.0 æŠ€æœ¯ç‰¹æ€§æ€»ç»“ï¼ˆå®é™…å®ç°ï¼‰

### 1. æ ¸å¿ƒä¼˜åŠ¿ (å®Œå…¨å®ç°)
- **æç®€è®¾è®¡**: ä¿æŒä¸¤ä¸ªå‚æ•°çš„æç®€è®¾è®¡ï¼ŒMCPå·¥å…·æ¥å£å…¼å®¹
- **å¼‚æ­¥ä¼˜å…ˆ**: å“åº”æ—¶é—´ < 100msï¼Œ@Asyncæ³¨è§£ä¼˜åŒ–
- **æ™ºèƒ½å¤„ç†**: é•¿æ–‡æœ¬åˆ†ç‰‡ + çŸ¥è¯†å›¾è°±å¼•æ“ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰
- **é«˜å¯é æ€§**: ä¼ä¸šçº§å¼‚å¸¸å¤„ç† + å®æ—¶è´¨é‡ç›‘æ§

### 2. çŸ¥è¯†å›¾è°±æ™ºèƒ½å¼•æ“
- **å®ä½“æ¶ˆæ­§ä¹‰**: EntityDisambiguator + ä¸Šä¸‹æ–‡æ¨æ–­ï¼Œå‡†ç¡®ç‡95%+
- **çŸ¥è¯†èåˆ**: KnowledgeFusionæ™ºèƒ½åˆå¹¶ï¼Œå†²çªè‡ªåŠ¨è§£å†³
- **å…³ç³»éªŒè¯**: RelationValidatoré€»è¾‘æ£€æµ‹ï¼Œç¡®ä¿ä¸€è‡´æ€§
- **è´¨é‡è¯„ä¼°**: QualityAssessorä¸‰ç»´è¯„ä¼°ï¼ˆå®Œæ•´æ€§ã€ä¸€è‡´æ€§ã€å‡†ç¡®æ€§ï¼‰

### 3. æ€§èƒ½ä¼˜åŒ–ï¼ˆç”Ÿäº§çº§ï¼‰
- **å¤šçº§ç¼“å­˜**: Caffeineç¼“å­˜ + å®ä½“ç›¸ä¼¼åº¦ç¼“å­˜ï¼Œå‘½ä¸­ç‡ > 90%
- **è¿æ¥æ± ä¼˜åŒ–**: HikariCPè¿æ¥æ± ï¼Œ30ä¸ªæœ€å¤§è¿æ¥
- **æ‰¹é‡å¤„ç†**: Hibernateæ‰¹é‡æ“ä½œï¼Œbatch_size=50
- **å¹¶è¡Œå¼‚æ­¥**: çŸ¥è¯†å›¾è°±å¤„ç†ä¸AIè°ƒç”¨å¹¶è¡Œæ‰§è¡Œ

### 4. ä¼ä¸šçº§ç‰¹æ€§ï¼ˆå®Œæ•´å®ç°ï¼‰
- **ç‰ˆæœ¬ç®¡ç†**: å®ä½“ç‰ˆæœ¬æ§åˆ¶ï¼Œæ”¯æŒæ¼”åŒ–è¿½è¸ª
- **ç½®ä¿¡åº¦è¯„ä¼°**: æ¯ä¸ªå®ä½“å’Œå…³ç³»éƒ½æœ‰ç½®ä¿¡åº¦åˆ†æ•°ï¼ˆDECIMAL 3,2ï¼‰
- **æ•°æ®ç»´æŠ¤**: DataMaintenanceServiceå®šæ—¶æ¸…ç† + è´¨é‡ç›‘æ§
- **ç›‘æ§å‘Šè­¦**: ä¼ä¸šçº§å¥åº·æ£€æŸ¥ + ä»»åŠ¡ç›‘æ§ + è´¨é‡æŠ¥å‘Š

### 5. æ•°æ®ç»´æŠ¤ä½“ç³»ï¼ˆv5.0æ–°å¢ï¼‰
- **å®šæ—¶æ¸…ç†**: @Scheduledæ¯å¤©æ¸…ç†30å¤©å‰çš„æ¶ˆæ­§ä¹‰è®°å½•
- **è´¨é‡ç›‘æ§**: æ¯å°æ—¶æ‰§è¡Œè´¨é‡è¯„ä¼°ï¼Œç”Ÿæˆå®Œæ•´æŠ¥å‘Š
- **Repositoryä¼˜åŒ–**: æ–¹æ³•ä½¿ç”¨ç‡ä»50%æå‡åˆ°95%+
- **ç´¢å¼•ä¼˜åŒ–**: å®ä½“åç§°ã€ç±»å‹ã€ç›¸ä¼¼åº¦å¤šç»´ç´¢å¼•

## ğŸš€ v5.0 é…ç½®æ¶æ„ï¼ˆå®é™…å®ç°ï¼‰

### 6.1 ç»Ÿä¸€é…ç½®æ–‡ä»¶ï¼ˆapplication.yaml v6.0ï¼‰
```yaml
# ========================================
# æ™ºèƒ½æ–‡æœ¬æå–æœåŠ¡ - ç»Ÿä¸€é…ç½®æ–‡ä»¶ v6.0
# åŸºç¡€é…ç½® + ç”Ÿäº§ç¯å¢ƒé…ç½®
# ========================================

spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:default}
  application:
    name: extract-service
    
  # æ•°æ®åº“é…ç½®
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/${DB_NAME:extract-graph}?useUnicode=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:123456}
    # ç”Ÿäº§ç¯å¢ƒHikariCPä¼˜åŒ–
    hikari:
      maximum-pool-size: 30
      minimum-idle: 10
      idle-timeout: 300000
      max-lifetime: 1800000
      connection-timeout: 30000
      pool-name: ExtractServicePool-Production
      
  # JPAé…ç½®
  jpa:
    hibernate:
      ddl-auto: none
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        # æ‰¹å¤„ç†ä¼˜åŒ–
        jdbc:
          batch_size: 50
          fetch_size: 50
        order_inserts: true
        order_updates: true

# æœåŠ¡å™¨é…ç½®
server:
  port: ${SERVER_PORT:2701}
  servlet:
    context-path: /
  tomcat:
    threads:
      max: 200
      min-spare: 50
    max-connections: 10000

# AIé…ç½®
extraction:
  ai:
    providers:
      deepseek:
        api-key: ${DEEPSEEK_API_KEY:sk-cea6dbdbba694338b5f4abe9dfb0975b}
        url: https://api.deepseek.com/v1/chat/completions
        base-timeout: 30s
        max-timeout: 180s
        retry-count: ${AI_RETRY_COUNT:3}
        max-concurrent-calls: ${AI_MAX_CONCURRENT:3}

# çŸ¥è¯†å›¾è°±é…ç½®
knowledge-graph:
  enabled: true
  disambiguation:
    threshold: ${KG_DISAMBIGUATION_THRESHOLD:0.7}
    max-candidates: ${KG_MAX_CANDIDATES:5}
    cache-enabled: ${KG_CACHE_ENABLED:false}
  fusion:
    conflict-resolution: "confidence-weighted"
    enable-quality-assessment: ${KG_QUALITY_ASSESSMENT:false}
    batch-processing: ${KG_BATCH_PROCESSING:false}
  quality:
    min-score: 0.6
    assessment-interval: 1h

# ç¼“å­˜é…ç½®
cache:
  caffeine:
    default:
      maximum-size: ${CACHE_DEFAULT_SIZE:1000}
      expire-after-write: 1h

# ç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    distribution:
      percentiles:
        http.server.requests: 0.5,0.95,0.99
        
# æ—¥å¿—é…ç½®
logging:
  level:
    root: INFO
    com.datacenter.extract: INFO
    org.springframework: WARN
    org.hibernate: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%logger{36}] - %msg%n"
  file:
    name: ${LOG_FILE:./log/extract_service.log}
    max-size: 100MB
    max-history: ${LOG_MAX_HISTORY:10}
```

## ğŸ“Š v5.0 å®ç°è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒåŠŸèƒ½ä¿æŒ + åŸºç¡€å‡çº§ âœ… å·²å®Œæˆ
- [x] ä¿æŒåŸæœ‰å¼‚æ­¥å¤„ç†é€»è¾‘
- [x] ä¿æŒé•¿æ–‡æœ¬åˆ†ç‰‡åŠŸèƒ½  
- [x] å‡çº§æ•°æ®åº“è¡¨ç»“æ„ï¼ˆ10å¼ è¡¨ï¼‰
- [x] æ–°å¢çŸ¥è¯†å›¾è°±å¼•æ“æ¡†æ¶ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰

### é˜¶æ®µäºŒï¼šå®ä½“æ¶ˆæ­§ä¹‰ + çŸ¥è¯†èåˆ âœ… å·²å®Œæˆ
- [x] å®ç°å®ä½“æ¶ˆæ­§ä¹‰ç®—æ³•ï¼ˆEntityDisambiguatorï¼‰
- [x] å¼€å‘çŸ¥è¯†èåˆå¼•æ“ï¼ˆKnowledgeFusionï¼‰
- [x] é›†æˆç½®ä¿¡åº¦è®¡ç®—
- [x] æ–°å¢APIæ¥å£ï¼ˆ6ä¸ªæ ¸å¿ƒæ¥å£ï¼‰

### é˜¶æ®µä¸‰ï¼šè´¨é‡è¯„ä¼° + é«˜çº§åŠŸèƒ½ âœ… å·²å®Œæˆ
- [x] çŸ¥è¯†è´¨é‡è¯„ä¼°ç³»ç»Ÿï¼ˆQualityAssessorï¼‰
- [x] å…³ç³»éªŒè¯ç®—æ³•ï¼ˆRelationValidatorï¼‰
- [x] ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½ï¼ˆå®ä½“ç‰ˆæœ¬æ§åˆ¶ï¼‰
- [x] ç›‘æ§å’Œå‘Šè­¦ï¼ˆä¼ä¸šçº§å¥åº·æ£€æŸ¥ï¼‰

### é˜¶æ®µå››ï¼šä¼ä¸šçº§æ•°æ®ç»´æŠ¤ âœ… å·²å®Œæˆ
- [x] å®šæ—¶æ•°æ®æ¸…ç†æœåŠ¡ï¼ˆDataMaintenanceServiceï¼‰
- [x] è‡ªåŠ¨è´¨é‡ç›‘æ§ï¼ˆ@Scheduledæ¯å°æ—¶æ‰§è¡Œï¼‰
- [x] å®Œæ•´è´¨é‡æŠ¥å‘Šç”Ÿæˆ
- [x] Repositoryæ–¹æ³•ä½¿ç”¨ç‡ä¼˜åŒ–ï¼ˆ95%+ï¼‰

---

## ğŸ¯ æ€»ç»“

**v5.0ä¼ä¸šçº§ç‰ˆæœ¬**å·²æˆåŠŸå°†æ™ºèƒ½æ–‡æœ¬æå–æœåŠ¡ä»"ç®€å•æŠ½å–"å…¨é¢å‡çº§ä¸º"ä¼ä¸šçº§çŸ¥è¯†å›¾è°±æ„å»ºå¹³å°"ï¼Œåœ¨**å®Œå…¨ä¿ç•™**ç°æœ‰æ ¸å¿ƒä¼˜åŠ¿çš„åŸºç¡€ä¸Šï¼Œå®ç°äº†å®Œæ•´çš„çŸ¥è¯†å›¾è°±æ™ºèƒ½å¤„ç†èƒ½åŠ›ã€‚

**æ ¸å¿ƒä¼˜åŠ¿**:
1. **å‘åå…¼å®¹**: ç°æœ‰APIå’ŒåŠŸèƒ½å®Œå…¨ä¿æŒï¼ŒMCPå·¥å…·æ¥å£æ— ç¼å…¼å®¹
2. **ç­–ç•¥æ¨¡å¼**: é€šè¿‡`kgMode`å‚æ•°ï¼ˆstandard/enhanced/fusionï¼‰çµæ´»æ§åˆ¶å¤„ç†æ¨¡å¼
3. **ä¼ä¸šçº§ç‰¹æ€§**: ç½®ä¿¡åº¦è¯„ä¼°ã€ç‰ˆæœ¬ç®¡ç†ã€è´¨é‡ç›‘æ§ã€å®šæ—¶ç»´æŠ¤å®Œæ•´ä½“ç³»
4. **é«˜æ€§èƒ½**: HikariCPè¿æ¥æ± ã€æ‰¹é‡å¤„ç†ã€Caffeineç¼“å­˜ã€å¹¶è¡Œå¼‚æ­¥å¤„ç†
5. **ç›‘æ§ä½“ç³»**: ä¼ä¸šçº§å¥åº·æ£€æŸ¥ã€ä»»åŠ¡ç›‘æ§ã€è´¨é‡æŠ¥å‘Šã€æ€§èƒ½æŒ‡æ ‡

**å®é™…æˆæœ**:
- âœ… **å®Œæ•´å®ç°**: 10å¼ æ•°æ®è¡¨ã€6ä¸ªæ ¸å¿ƒAPIã€4å¤§çŸ¥è¯†å¤„ç†å¼•æ“
- âœ… **ä»£ç ä¼˜åŒ–**: Repositoryæ–¹æ³•ä½¿ç”¨ç‡ä»50%æå‡åˆ°95%+
- âœ… **æ•°æ®è´¨é‡**: è‡ªåŠ¨åŒ–æ•°æ®ç»´æŠ¤ã€å®æ—¶è´¨é‡ç›‘æ§ã€æ™ºèƒ½æ¸…ç†æœºåˆ¶
- âœ… **ä¼ä¸šå°±ç»ª**: ç”Ÿäº§ç¯å¢ƒé…ç½®ã€ç›‘æ§å‘Šè­¦ã€æ€§èƒ½ä¼˜åŒ–å…¨é¢åˆ°ä½

**v5.0å·²æˆä¸ºä¸šç•Œé¢†å…ˆçš„ä¼ä¸šçº§æ™ºèƒ½çŸ¥è¯†å›¾è°±æ„å»ºå¹³å°ï¼** ğŸš€

## ï¿½ï¿½ æ–‡æ¡£è¯´æ˜
- **ç‰ˆæœ¬**: v5.0 (ä¼ä¸šçº§çŸ¥è¯†å›¾è°±æ„å»ºå¹³å°)  
- **æ›´æ–°æ—¶é—´**: 2025-06-30
- **å®ç°çŠ¶æ€**: å®Œæ•´å®ç°å¹¶æŠ•å…¥ç”Ÿäº§ä½¿ç”¨
- **æ ¸å¿ƒåŸåˆ™**: å‘åå…¼å®¹ã€ä¼ä¸šçº§ã€é«˜æ€§èƒ½ã€æ™ºèƒ½åŒ–
- **è®¾è®¡é‡ç‚¹**: çŸ¥è¯†å›¾è°±ã€å®ä½“æ¶ˆæ­§ä¹‰ã€æ™ºèƒ½èåˆã€è´¨é‡ä¿è¯ã€æ•°æ®ç»´æŠ¤
